import numpy as np
import pandas as pd

#############
# CONSTANTS #
#############

r = 11.0
ma = 141.0 #kg/s
n_c = 0.854
n_t = 0.868
n_comb = 0.99
dP_comb = 0.012
LHV = 48235.63 #kJ/kg
T5 = 1385 #K
dP_inlet = 100 #mmH2O
dP_exhaust = 200 #mmH2O
g = 1.4

######################
# INITIAL CONDITIONS #
######################

P3 = 101325 #Pa
T3 = 288.0 #K

######################
# HEAT CAPACITY DRY  #
######################

d_t_values = np.array([ 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 450, 500, 550, 600, 650, 700, 750, 800, 850, 900, 950, 1000, 1050, 1100, 1150, 1200, 1250, 1300, 1350, 1400, 1500, 1600, 1700, 1800, 1900])

d_cp_values = [ 1.0023, 1.0025, 1.0027, 1.0031, 1.0038, 1.0049, 1.0063, 1.0082, 1.0106, 1.0135, 1.0206, 1.0295, 1.0398, 1.0511, 1.0629, 1.075 , 1.087 , 1.0987, 1.1101, 1.1209, 1.1313, 1.1411, 1.1502, 1.1589, 1.167 , 1.1746, 1.1817, 1.1884, 1.1946, 1.2005, 1.2112, 1.2207, 1.2293, 1.237 , 1.244 ]

d_cv_values = [ 0.7152, 0.7154, 0.7156, 0.716 , 0.7167, 0.7178, 0.7192, 0.7211, 0.7235, 0.7264, 0.7335, 0.7424, 0.7527, 0.764 , 0.7758, 0.7879, 0.7999, 0.8116, 0.823 , 0.8338, 0.8442, 0.854 , 0.8631, 0.8718, 0.8799, 0.8875, 0.8946, 0.9013, 0.9075, 0.9134, 0.9241, 0.9336, 0.9422, 0.9499, 0.9569]

def dry_air(T):
    a = 28.11
    b = 0.001967
    c = 4.802e-6
    d = -1.966e-9
    e = 131.31
    Ru = 8.31447 #KJ/kmol-K
    mol_wt = 28.97 #kg/kmol

    Cp = a + b*T + c*T**2 + d*T**3 #kJ/kmol-K
    h = a*T + (b/2)*T**2 + (c/3)*T**3 + (d/4)*T**4 + e #kJ/kmol
    u = h - Ru*T #kJ/kmol
    Cv = Cp - Ru #kJ/kmol-K
    g = Cp/Cv
    return Cp/mol_wt, h/mol_wt, u/mol_wt, Cv/mol_wt, g

#####################
# HEAT CAPACITY WET #
#####################

w_t_vals = np.array([ 175, 200, 225, 250, 275, 300, 325, 350, 375, 400, 450, 500, 550, 600, 650, 700, 750, 800, 850, 900, 950, 1000, 1050, 1100, 1150, 1200, 1250, 1300, 1350, 1400, 1500, 1600, 1700, 1800, 1900, 2000, 2100, 2200, 2300, 2400, 2500, 2600, 2700, 2800, 2900, 3000, 3500, 4000, 4500, 5000, 5500, 6000])
w_cp_vals = np.array([ 1.85, 1.851, 1.852, 1.855, 1.859, 1.864, 1.871, 1.88 , 1.89 , 1.901, 1.926, 1.954, 1.984, 2.015, 2.047, 2.08 , 2.113, 2.147, 2.182, 2.217, 2.252, 2.288, 2.323, 2.358, 2.392, 2.425, 2.458, 2.49 , 2.521, 2.552, 2.609, 2.662, 2.711, 2.756, 2.798, 2.836, 2.872, 2.904, 2.934, 2.962, 2.987, 3.011, 3.033, 3.053, 3.072, 3.09 , 3.163, 3.217, 3.258, 3.292, 3.322, 3.35 ])

def water_vapor(T):
    # Valid from 273 to 1800 K
    a = 32.24
    b = 0.1923e-2
    c = 1.055e-5
    d = -3.595e-9

    cp = a + b*T + c*T**2 + d*T**3
    return cp


############
# CT MODEL #
############

P4 = r*P3

T4 = (T3/n_c)*(((P4/P3)**((g-1)/g))-1) + T3

cp_avg_34 = (dry_air(T4)[0] + dry_air(T3)[0])/2

Wc = ma*cp_avg_34*(T4-T3)

P5 = P4*(1-dP_comb)

cp_avg_45 = (dry_air(T4)[0] + dry_air(T5)[0])/2

Qin = ma*cp_avg_45*(T5 - T4)

P6 = P3

mf = (Qin/LHV)/n_comb

mt = ma + mf

# T6 = T5 - n_t*T5*(1-(1/(P5/P6))**((g-1)/g)) #In original source, 2nd T is T4, not T5

T6 = T5 - n_t*(T5 - T5*(P6/P5)**((g-1)/g))

cp_avg_56 = (dry_air(T5)[0] + dry_air(T6)[0])/2

Wt = mt*cp_avg_56*(T5 - T6)

Wnet = Wt - Wc




